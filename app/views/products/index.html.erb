<% content_for(:page_styles) { %>
  <%= stylesheet_link_tag "pages/products", "data-turbo-track": "reload" %>
<% } %>

<main data-controller="products">
  <section class="products-header">
    <h1>Каталог товаров</h1>
  </section>

  <div class="products-container">
    <%= turbo_frame_tag "products-list" do %>
      <section class="products" id="products" data-products-target="productsContainer">
        <% @products.each do |product| %>
          <div class="card" data-name="<%= product.name %>" data-price="<%= product.price %>" data-category="<%= product.category_id %>">
            <% if product.image.attached? %>
              <%= image_tag product.image, class: "product-image" %>
            <% end %>
            <h3><%= product.name %></h3>
            <span class="category-badge"><%= product.category&.name %></span>
            <div class="price">$<%= product.price %></div>
            <p>Количество: <%= product.quantity %></p>
            <p class="description"><%= product.description %></p>
            <button>В корзину</button>
          </div>
        <% end %>
      </section>
    <% end %>

    <aside class="products-sidebar">
      <h3>Сортировка</h3>
      <select id="sort" data-action="change->products#sort">
        <option value="default">По умолчанию</option>
        <option value="price-asc">Цена: по возрастанию</option>
        <option value="price-desc">Цена: по убыванию</option>
        <option value="name-asc">Название: А–Я</option>
        <option value="name-desc">Название: Я–А</option>
      </select>

      <h3>Категории</h3>
      <div class="categories-list">
        <%= link_to "Все товары", products_path, class: "category-btn #{'active' if params[:category_id].blank?}", data: { turbo_frame: "products-list" } %>
        
        <% @categories.each do |category| %>
          <%= link_to "#{category.name} (#{category.products.count})", products_path(category_id: category.id), class: "category-btn #{'active' if params[:category_id] == category.id.to_s}", data: { turbo_frame: "products-list" } %>
        <% end %>
      </div>
    </aside>
  </div>
</main>
