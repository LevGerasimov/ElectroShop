<% content_for(:page_styles) { %>
  <%= stylesheet_link_tag "pages/products", "data-turbo-track": "reload" %>
<% } %>

<main>
  <section class="products-header">
    <h1>Каталог товаров</h1>
  </section>

  <div class="products-container">
    <section class="products" id="products">
      <% @products.each do |product| %>
        <div class="card" data-name="<%= product.name %>" data-price="<%= product.price %>">
          <% if product.image.attached? %>
            <%= image_tag product.image, class: "product-image" %>
          <% end %>
          <h3><%= product.name %></h3>
          <div class="price">$<%= product.price %></div>
          <p>Количество: <%= product.quantity %></p>
          <p class="description"><%= product.description %></p>
          <button>В корзину</button>
        </div>
      <% end %>
    </section>

    <aside class="products-sidebar">
      <h3>Сортировка</h3>
      <select id="sort" onchange="sortProducts()">
        <option value="default">По умолчанию</option>
        <option value="price-asc">Цена: по возрастанию</option>
        <option value="price-desc">Цена: по убыванию</option>
        <option value="name-asc">Название: А–Я</option>
        <option value="name-desc">Название: Я–А</option>
      </select>
    </aside>
  </div>
</main>

<script>
  function sortProducts() {
    const container = document.getElementById('products');
    const cards = Array.from(container.children);
    const sortValue = document.getElementById('sort').value;

    let sortedCards = [...cards];

    if (sortValue === 'price-asc') {
      sortedCards.sort((a, b) => a.dataset.price - b.dataset.price);
    }
    if (sortValue === 'price-desc') {
      sortedCards.sort((a, b) => b.dataset.price - a.dataset.price);
    }
    if (sortValue === 'name-asc') {
      sortedCards.sort((a, b) => a.dataset.name.localeCompare(b.dataset.name));
    }
    if (sortValue === 'name-desc') {
      sortedCards.sort((a, b) => b.dataset.name.localeCompare(a.dataset.name));
    }

    container.innerHTML = '';
    sortedCards.forEach(card => container.appendChild(card));
  }
</script>
